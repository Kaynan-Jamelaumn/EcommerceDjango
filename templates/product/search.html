{% extends 'base.html'%}
{% load static %}
{% block title %}
{% if search %}
<h2>Results Searched for: {{search}}</h2>
{% endif %}
{% endblock %}
{% block content %}
<div class="container">

  {% if onPromotion %}
  <div class="mx-30">
    <h2 class="text-center font-xxl green my-10"> On Promotion</h2>
    <div class="carousel-box gambiarra">
      <div class="carousel-container auto text-center">
        {% for product in onPromotion %}
        <div class="img-limiter-carousel">
          <img class="carousel-image {% if forloop.first %} active {% endif %}"
            src="{% if product.image.url %} {{product.image.url}} {% else %} /media/image.jpg {% endif %}">
          <div class="info bg-black white {% if forloop.first %} active {% endif %}">
            <div>
              <a class="font-m white green-active relative underline-xs-green"
                href="{{product.get_absolute_url}}">{{product.name}}</a>
            </div>
            {% for variation in product.productvariation_set.all %}
            {% if variation.product.id == product.id %}
            {% if forloop.first %}
            <p class="font-m white mt-3">Price: {{variation.promotion_price}}</p>
            {% endif %}
            {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endfor %}
        <button class="carousel-prev font-xl">Prev</button>
        <button class="carousel-next font-xl">Next</button>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="mx-30">
    <div class="w100 card mt-15">
      {% for product in products %}
      <div class="cflex space-between radius-10 border-xl border-white bg-black font-l w100 text-center white">
        <div class="my-10">
          <a class="font-xl white relative green-active underline-s-green"
            href="{% url 'ecommerce:product:detail' product.slug %}">{{product.name}}</a>
        </div>
        {% if product.image %}
        <div class="img-limiter">
          <img src="{{product.image.url}}" alt="{{product.image.url}}">
        </div>
        {% else %}
        <div class="img-limiter">
          <img src="/media/image.jpg" alt="no image">
        </div>
        {% endif %}

        {% for variation in product.productvariation_set.all %}
        {% if variation.product.id == product.id %}
        {% if forloop.first %}
        {% if product.on_promotion == True %}
        {% if variation.on_promotion == True %}
        {% if variation.promotion_price %}
        <p class="mt-3"> Original Price: {{variation.price}}</p>
        <p class="mt-3"> Current price in promotion: {{variation.promotion_price}}</p>
        {% else %}
        <p class="mt-3"> Price: {{variation.price}}</p>
        {% endif %}
        {% else %}
        <p class="mt-3"> Price: {{variation.price}}</p>
        {% endif %}
        {% else %}
        <p class="mt-3">Price: {{variation.price}}</p>
        {% endif %}

        {% if variation.short_description %}
        <p class="mt-3 px-3">{{variation.short_description}}</p>
        {% endif %}
        <div class="button-box bg-black-vibrant mt-3">

          <a class="button py-3 bg-purple bg-purple-pale-active white white-pale-active font-xxl"
            href="{% url 'ecommerce:product:detail' product.slug %}"> Variations</a>

          {% if variation.stock >= 1 %}
          <button type="submit" data-variation_id="{{variation.id}}"
            class="add_to_cart_button button w100 bg-green-4 bg-green-3-active white  font-xxl ">Add To <i
              class="fa-solid fa-cart-shopping"></i></button>
          {% else %}
          <p class="h60-px flex items-center justify-center px-3">Out of stock, check other variations</p>
          {% endif %}
        </div>
        {% endif %}
        {% endif %}
        {% endfor %}
      </div>
      {% endfor %}
    </div>
    {% include 'partials/_paginator.html' %}
  </div>
</div>
<script>
  const url_add_to_cart = '{% url "ecommerce:cart:add" %}'
  const csrf_token = "{{csrf_token}}"
</script>
<script src="{% static 'js/product/addToCart.js' %}"></script>

{% endblock %}